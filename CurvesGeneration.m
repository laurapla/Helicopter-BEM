%% Cd-alpha and Cl-alpha curves generation
clc; clear;

%% Data from xflr.txt
Data_xflr=[...
0.000  0.0000   0.00507   0.00077   0.0000  0.5474  0.5474  -0.4143   0.0000   1.3043
   0.500   0.0558   0.00509   0.00078   0.0001  0.4990  0.5944  -0.4808   0.0000   0.2442
   1.000   0.1112   0.00513   0.00082   0.0002  0.4480  0.6450  -0.5594   0.0000   0.2435
   1.500   0.1667   0.00524   0.00088   0.0004  0.3971  0.6919  -0.6557   0.0000   0.2432
   2.000   0.2220   0.00535   0.00098   0.0005  0.3486  0.7388  -0.7705   0.0000   0.2428
   2.500   0.2768   0.00551   0.00111   0.0008  0.2996  0.7849  -0.9069   0.0000   0.2421
   3.000   0.3316   0.00573   0.00126   0.0011  0.2522  0.8250  -1.0670   0.0000   0.2416
   3.500   0.3854   0.00600   0.00147   0.0016  0.2034  0.8648  -1.2401   0.0000   0.2405
   4.000   0.4393   0.00631   0.00171   0.0021  0.1624  0.8974  -1.4509   0.0000   0.2396
   4.500   0.4928   0.00666   0.00197   0.0027  0.1272  0.9242  -1.6685   0.0000   0.2387
   5.000   0.5456   0.00702   0.00225   0.0035  0.0995  0.9473  -1.9143   0.0000   0.2375
   5.500   0.5979   0.00744   0.00258   0.0043  0.0761  0.9656  -2.1912   0.0000   0.2363
   6.000   0.6513   0.00784   0.00290   0.0049  0.0600  0.9800  -2.4819   0.0000   0.2356
   6.500   0.7130   0.00828   0.00326   0.0035  0.0480  0.9871  -2.8068   0.0000   0.2378
   7.000   0.7736   0.00873   0.00365   0.0024  0.0398  0.9929  -3.1538   0.0000   0.2392
   7.500   0.8401   0.00918   0.00407  -0.0002  0.0338  0.9946  -3.5892   0.0000   0.2420
   8.000   0.9047   0.00975   0.00459  -0.0023  0.0269  0.9968  -4.0317   0.0000   0.2439
   8.500   0.9690   0.01019   0.00502  -0.0044  0.0251  0.9989  -4.4984   0.0000   0.2454
   9.000   1.0248   0.01077   0.00557  -0.0048  0.0214  1.0000  -4.9432   0.0000   0.2449
   9.500   1.0667   0.01135   0.00618  -0.0021  0.0187  1.0000  -5.3403   0.0000   0.2416
  10.000   1.1115   0.01178   0.00663  -0.0001  0.0182  1.0000  -5.7759   0.0000   0.2390
  10.500   1.1566   0.01234   0.00720   0.0018  0.0169  1.0000  -6.2204   0.0000   0.2367
  11.000   1.2021   0.01303   0.00788   0.0035  0.0152  1.0000  -6.6802   0.0000   0.2347
  11.500   1.2472   0.01386   0.00876   0.0051  0.0135  1.0000  -7.1341   0.0000   0.2328
  12.000   1.2899   0.01495   0.00998   0.0070  0.0121  1.0000  -7.5701   0.0000   0.2307
  12.500   1.3369   0.01556   0.01061   0.0081  0.0120  1.0000  -8.1583   0.0000   0.2293
  13.000   1.3829   0.01621   0.01128   0.0093  0.0118  1.0000  -8.7577   0.0000   0.2278
  13.500   1.4270   0.01697   0.01207   0.0107  0.0114  1.0000  -9.3591   0.0000   0.2262
  14.000   1.4677   0.01792   0.01306   0.0125  0.0106  1.0000  -9.9487   0.0000   0.2243
  14.500   1.5038   0.01909   0.01429   0.0149  0.0098  1.0000  -10.5158   0.0000   0.2221
  15.000   1.5308   0.02046   0.01574   0.0187  0.0091  1.0000  -11.0297   0.0000   0.2189
  15.500   1.5513   0.02214   0.01754   0.0228  0.0087  1.0000  -11.5027   0.0000   0.2155
  16.000   1.5673   0.02430   0.01985   0.0265  0.0084  1.0000  -11.9444   0.0000   0.2123
  16.500   1.5778   0.02715   0.02287   0.0296  0.0081  1.0000  -12.3445   0.0000   0.2094
  17.000   1.5823   0.03098   0.02690   0.0314  0.0079  1.0000  -12.6933   0.0000   0.2072
  17.500   1.5793   0.03630   0.03244   0.0316  0.0078  1.0000  -12.9693   0.0000   0.2059
  18.000   1.5660   0.04361   0.03999   0.0297  0.0077  1.0000  -13.1391   0.0000   0.2056
  18.500   1.5406   0.05350   0.05013   0.0255  0.0076  1.0000  -13.1739   0.0000   0.2067
  19.000   1.4969   0.06666   0.06358   0.0192  0.0076  1.0000  -13.0052   0.0000   0.2091
  19.500   1.4382   0.08298   0.08018   0.0109  0.0076  1.0000  -12.6417   0.0000   0.2129
  20.000   1.3650   0.10233   0.09981   0.0011  0.0077  1.0000  -12.0678   0.0000   0.2185
  20.500   1.2841   0.12392   0.12167  -0.0102  0.0078  1.0000  -11.3213   0.0000   0.2261
  21.000   1.2056   0.14662   0.14464  -0.0227  0.0079  1.0000  -10.4779   0.0000   0.2361
  21.500   1.1436   0.16745   0.16568  -0.0348  0.0080  1.0000  -9.7126   0.0000   0.2469
  22.000   1.0992   0.18597   0.18439  -0.0458  0.0080  1.0000  -9.0695   0.0000   0.2575
  22.500   1.0374   0.21157   0.21023  -0.0610  0.0080  1.0000  -7.8969   0.0000   0.2746];

%% Impose physical limitations
% Since our airfoil is symmetric, we will just compute the positive part
% of the curve and then reverse it

% To impose the limitations, we find a cubic curve that matches the 
% derivative and the value of the last computed point and tends to 0
a1=Data_xflr(46,1); % Last simulated angle
a2=a1+5;            % Point to finish at 0

% System of equations to find polynomic coefficients
A=[3*a1^2 2*a1 1 0
   3*a2^2 2*a2 1 0
   a2^3 a2^2 a2 1
   a1^3 a1^2 a1 1];

b=[Data_xflr(46,2)-Data_xflr(44,2)
    0
    0
    Data_xflr(46,2)];

r=A\b; % Polynomic coefficients

aext=a1+0.5:0.5:a2;
clext=r(1)*aext.^3+r(2)*aext.^2+r(3)*aext+r(4);

% We assembly the data and the computed extra points
% The last point is added to assign 0 to very big angle values
Cl=[Data_xflr(:,2)' clext zeros(1,126)];
ang=[Data_xflr(:,1)' aext 1000*ones(1,126)];

% Duplication of the arrays
Cl=[-fliplr(Cl) Cl(2:end)];
ang=[-fliplr(ang) ang(2:end)];

plot(ang,Cl);

%% Drag computation
a1=Data_xflr(46,1); % Last simulated angle
a2=90;            % Point to finish at 1

% System of equations to find polynomic coefficients
A=[3*a1^2 2*a1 1 0
   3*a2^2 2*a2 1 0
   a2^3 a2^2 a2 1
   a1^3 a1^2 a1 1];
    
b=[Data_xflr(46,3)-Data_xflr(44,3)
    0
    1
    Data_xflr(46,3)];

r=A\b; % Polynomic coefficients

aext=a1+0.5:0.5:a2;
cdext=r(1)*aext.^3+r(2)*aext.^2+r(3)*aext+r(4);

% We assembly the data and the computed extra points
% The last point is added to assign 0 to very big angle values
ang_cd=[Data_xflr(:,1)' aext 180];
Cd=[Data_xflr(:,3)' cdext 0];

% Duplication of the arrays
Cd=[fliplr(Cd) Cd(2:end)];
ang_cd=[-fliplr(ang_cd) ang_cd(2:end)];

plot(ang_cd,Cd);

aClaCd=[ang' Cl' ang_cd' Cd'];
save('Data_xflr_file.mat','aClaCd');
